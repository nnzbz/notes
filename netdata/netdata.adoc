= netdata

== 安装
[source,bash]
----
# 安装
yum install -y netdata
# 启动
systemctl start netdata
# 设置开机启动
systemctl enable netdata
----

== 集群配置
=== 子节点
./usr/lib/netdata/conf.d/netdata.conf
[source,ini]
----
....
[db]
    # https://github.com/netdata/netdata/blob/master/src/database/README.md
    # none = no retention, ram = some retention in ram
    mode = ram
    # The retention in seconds.
    # This provides some tolerance to the time the child has to find a parent in
    # order to transfer the data. For IoT this can be lowered to 120.
    retention = 1200
    # The granularity of metrics, in seconds.
    # You may increase this to lower CPU resources.
    update every = 1
[ml]
    # Disable Machine Learning
    enabled = no
[health]
    # Disable Health Checks (Alerting)
    enabled = no
[web]
    # Disable remote access to the local dashboard
    bind to = lo
[plugins]
    ....
----

./usr/lib/netdata/conf.d/stream.conf
[source,ini]
----
....
[stream]
    # Stream metrics to another Netdata
    enabled = yes
    # The IP and PORT of the parent
    destination = <PARENT_IP_ADDRESS>:19999
    # The shared API key, generated by uuidgen
    api key = <API_KEY>
----

=== 父节点
./usr/lib/netdata/conf.d/netdata.conf
[source,ini]
----
[db]
    mode = dbengine
    dbengine tier backfill = new
    storage tiers = 3
    dbengine page cache size = 1.4GiB
    # storage tier 0
    update every = 1
    dbengine tier 0 retention space = 12GiB
    # storage tier 1
    dbengine tier 1 update every iterations = 60
    dbengine tier 1 retention space = 4GiB
    # storage tier 2
    dbengine tier 2 update every iterations = 60
    dbengine tier 2 retention space = 2GiB
----

./usr/lib/netdata/conf.d/stream.conf
[source,ini]
----
....
[<API_KEY>]
    # Accept metrics streaming from other Agents with the specified API key
    enabled = yes
----
