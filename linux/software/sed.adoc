= sed
:scripts: cjk
:toc: left
:toc-title: 目录
:toclevels: 4

== 1. 准备

查看内容并打印行号(nl)

```sh
nl /etc/mysql/my.cnf
```

== 2. sed 命令说明

=== 2.1. 选项

- -n
  使用安静(silent)模式。
- -e
  直接在命令列模式上进行 sed 的动作编辑；
- -f
  直接将 sed 的动作写在一个文件内， -f filename 则可以运行 filename 内的 sed 动作；
- -r
  sed 的动作支持的是延伸型正规表示法的语法。(默认是基础正规表示法语法)
- -i
  直接修改读取的文件内容，而不是输出到终端。

=== 2.2. function

a ：新增， a 的后面可以接字串，而这些字串会在新的一行出现(目前的下一行)～
c ：取代， c 的后面可以接字串，这些字串可以取代 n1,n2 之间的行！
d ：删除，因为是删除啊，所以 d 后面通常不接任何咚咚；
i ：插入， i 的后面可以接字串，而这些字串会在新的一行出现(目前的上一行)；
p ：列印，亦即将某个选择的数据印出。通常 p 会与参数 sed -n 一起运行～
s ：取代，可以直接进行取代的工作哩！通常这个 s 的动作可以搭配正规表示法！例如 1,20s/old/new/g 就是啦！

== 3. 特殊字符

- `/`
  将原来的分隔符的地方由 `/` 替换为 `#`
- `'`
  使用反斜杠 `\` 转义

== 4. 常见场景
=== 4.1. 新增/替换/删除一行

- 以行为单位的新增

```sh
sed -i '8a max_connections=200' /etc/mysql/my.cnf
```

8a是指在第8行后新增一行，而替换或删除只用将a换为c或d就可以了

=== 4.2. 替换匹配的内容

```sh
sed -i '5s/https/http/g' /var/jenkins_home/hudson.model.UpdateCenter.xml
```

- 开头的 `5` 指的是第五行，如果不指定行，可以去掉
- 后尾的 `g` 指的是匹配行的任意位置，如去掉，只匹配行开头
