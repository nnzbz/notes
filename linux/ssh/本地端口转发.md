# 本地端口转发

[TOC]

## 1. 应用场景

云主机的防火墙如果默认只打开了22端口，如果需要访问3000端口的话，需要修改防火墙。为了保证安全，防火墙需要配置允许访问的IP地址。但是，本地公网IP通常是网络提供商动态分配的，是不断变化的。这样的话，防火墙配置需要经常修改，就会很麻烦。

## 2. 命令

```sh
ssh -fNTL 本地网卡地址:本地端口:目标地址:目标端口 远程服务器地址
```

- f
  表示SSH连接成功后，转入后台运行。这样一来，你就可以在不中断SSH连接的情况下，在本地shell中执行其他操作。
- N
  表示只连接远程主机，不打开远程shell
- T
  表示不为这个连接分配TTY。T和N这个两个参数可以放在一起用，代表这个SSH连接只用来传数据，不执行远程操作。
- L
  本地端口转发
- 本地网卡地址
  可以省略，则表示监听所有网卡
- 本地端口
  本地映射远程的端口
- 远程目标的本地地址
  相对远程服务器来说的目标地址，所以如果是转发远程服务器本机的话，则是127.0.0.1；如果是远程服务器能访问的一台局域网内的机器的话，则是此机器的局域网地址
- 目标端口
  要转发目标的端口
- 远程服务器地址
  完整的格式是 `root@<IP> -p <SSH打开的端口号>`

## 3. 示例

```sh
ssh -fNTL 3316:127.0.0.1:3316 root@211.21.138.25 -p12345
```
